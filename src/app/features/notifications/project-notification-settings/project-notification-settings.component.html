<div class="bg-white rounded-lg shadow-sm">
  <!-- Loading State -->
  @if (loading()) {
    <div class="p-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-4 text-gray-600">Loading notification settings...</p>
    </div>
  }

  <!-- Error State -->
  @else if (error()) {
    <div class="p-6">
      <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
        <p class="text-red-800">{{ error() }}</p>
        <button
          (click)="loadSettings()"
          class="mt-3 px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition-colors">
          Retry
        </button>
      </div>
    </div>
  }

  <!-- Settings Form -->
  @else {
    <div class="p-6 space-y-6">
      <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Notification Settings</h3>
        <p class="text-sm text-gray-600 mb-6">Configure how notifications are sent for this project</p>
      </div>

      <!-- Slack Integration -->
      <div class="border border-gray-200 rounded-lg p-4">
        <div class="flex items-start gap-3 mb-4">
          <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"></path>
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-900">Slack Webhook</h4>
            <p class="text-sm text-gray-600 mt-1">Notifications will be sent to your Slack workspace</p>
          </div>
        </div>

        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Webhook URL</label>
            <input
              type="url"
              [value]="settings().slack_webhook_url"
              (input)="updateSetting('slack_webhook_url', $any($event.target).value)"
              placeholder="https://hooks.slack.com/services/..."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
            <p class="mt-1 text-xs text-gray-500">Get your webhook URL from Slack's Incoming Webhooks app</p>
          </div>

          @if (settings().slack_webhook_url) {
            <button
              (click)="openWebhookTest()"
              class="text-sm text-blue-600 hover:text-blue-700 font-medium">
              Test Webhook Connection â†’
            </button>
          }
        </div>
      </div>

      <!-- Notification Types -->
      <div class="space-y-3">
        <h4 class="font-medium text-gray-900">Notification Types</h4>

        <!-- Issue Created -->
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
          <div>
            <h5 class="text-sm font-medium text-gray-900">Issue Created</h5>
            <p class="text-xs text-gray-600">Notify when a new issue is created</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              [checked]="settings().notify_on_issue_created"
              (change)="updateSetting('notify_on_issue_created', $any($event.target).checked)"
              class="sr-only peer">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <!-- Sprint Started -->
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
          <div>
            <h5 class="text-sm font-medium text-gray-900">Sprint Started</h5>
            <p class="text-xs text-gray-600">Notify when a sprint is started</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              [checked]="settings().notify_on_sprint_started"
              (change)="updateSetting('notify_on_sprint_started', $any($event.target).checked)"
              class="sr-only peer">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>

        <!-- Sprint Completed -->
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
          <div>
            <h5 class="text-sm font-medium text-gray-900">Sprint Completed</h5>
            <p class="text-xs text-gray-600">Notify when a sprint is completed</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              [checked]="settings().notify_on_sprint_completed"
              (change)="updateSetting('notify_on_sprint_completed', $any($event.target).checked)"
              class="sr-only peer">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
          </label>
        </div>
      </div>
    </div>

    <!-- Footer Actions -->
    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end">
      <button
        (click)="saveSettings()"
        [disabled]="saving()"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
        @if (saving()) {
          <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
          <span>Saving...</span>
        } @else {
          <span>Save Settings</span>
        }
      </button>
    </div>
  }
</div>

<!-- Slack Webhook Test Modal -->
@if (showWebhookTest()) {
  <app-slack-webhook-test
    [webhookUrl]="settings().slack_webhook_url"
    (closeE)="closeWebhookTest()">
  </app-slack-webhook-test>
}
