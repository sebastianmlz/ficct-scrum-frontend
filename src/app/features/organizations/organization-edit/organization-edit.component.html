<div class="min-h-screen bg-gray-50">
  <header class="bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 shadow-lg rounded-b-2xl animate-fade-in">
    <div class="max-w-4xl mx-auto py-4 px-4 flex items-center space-x-4">
      <a [routerLink]="['/organizations', organizationId]" class="text-white hover:text-gray-200 transition-transform transform hover:-translate-x-1">
        <i class="pi pi-arrow-left text-2xl"></i>
      </a>
      <h1 class="text-2xl font-extrabold text-white tracking-wide drop-shadow-lg">Editar organización</h1>
    </div>
  </header>

  <main class="max-w-3xl mx-auto py-6 sm:px-6 lg:px-8">
    <div class="px-4 py-6 sm:px-0">
      @if (loading()) {
        <div class="flex justify-center items-center py-12">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
        </div>
      } @else if (loadError()) {
        <div class="bg-red-50 border border-red-200 rounded-md p-4">
          <div class="flex">
            <div class="ml-3">
              <h3 class="text-sm font-medium text-red-800">Error loading organization</h3>
              <p class="mt-1 text-sm text-red-700">{{ loadError() }}</p>
            </div>
          </div>
        </div>
      } @else {
  <div class="bg-white shadow-xl rounded-2xl border border-purple-100 animate-fade-in">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-bold text-purple-700">Información de la organización</h2>
            <p class="mt-1 text-base text-gray-500">
              Actualiza los detalles y configuración de tu organización.
            </p>
          </div>

          @if (saveError()) {
            <div class="mx-6 mt-4 bg-red-50 border border-red-200 rounded-md p-4">
              <div class="flex">
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-red-800">Error updating organization</h3>
                  <p class="mt-1 text-sm text-red-700">{{ saveError() }}</p>
                </div>
              </div>
            </div>
          }

          @if (successMessage()) {
            <div class="mx-6 mt-4 bg-green-50 border border-green-200 rounded-md p-4">
              <div class="flex">
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-green-800">Success</h3>
                  <p class="mt-1 text-sm text-green-700">{{ successMessage() }}</p>
                </div>
              </div>
            </div>
          }

          <form [formGroup]="organizationForm" (ngSubmit)="onSubmit()" class="p-6 space-y-6">
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div>
                <label for="name" class="block text-sm font-medium text-gray-700">
                  Organization Name *
                </label>
                <input
                  id="name"
                  type="text"
                  formControlName="name"
                  placeholder="Enter organization name"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  [class.border-red-300]="organizationForm.get('name')?.invalid && organizationForm.get('name')?.touched"
                />
                @if (organizationForm.get('name')?.invalid && organizationForm.get('name')?.touched) {
                  <p class="mt-1 text-sm text-red-600">Organization name is required</p>
                }
              </div>
            </div>
            <!-- Botones de acción deben ir fuera del grid de inputs -->
            <!-- ...inputs y campos del formulario... -->

            <div>
              <label for="description" class="block text-sm font-medium text-gray-700">
                Description
              </label>
              <textarea
                id="description"
                formControlName="description"
                rows="3"
                placeholder="Describe your organization..."
                class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              ></textarea>
            </div>

            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div>
                <label for="organizationType" class="block text-sm font-medium text-gray-700">
                  Organization Type
                </label>
                <select
                  id="organizationType"
                  formControlName="organization_type"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                >
                  <option value="">Select type...</option>
                  @for (type of organizationTypes; track type.value) {
                    <option [value]="type.value">{{ type.label }}</option>
                  }
                </select>
              </div>

              <div>
                <label for="subscriptionPlan" class="block text-sm font-medium text-gray-700">
                  Subscription Plan
                </label>
                <select
                  id="subscriptionPlan"
                  formControlName="subscription_plan"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                >
                  <option value="">Select plan...</option>
                  @for (plan of subscriptionPlans; track plan.value) {
                    <option [value]="plan.value">{{ plan.label }}</option>
                  }
                </select>
              </div>
            </div>

            <div>
              <label for="websiteUrl" class="block text-sm font-medium text-gray-700">
                Website URL
              </label>
              <input
                id="websiteUrl"
                type="url"
                formControlName="website_url"
                placeholder="https://example.com"
                class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                [class.border-red-300]="organizationForm.get('website_url')?.invalid && organizationForm.get('website_url')?.touched"
              />
              @if (organizationForm.get('website_url')?.invalid && organizationForm.get('website_url')?.touched) {
                <p class="mt-1 text-sm text-red-600">Please enter a valid URL</p>
              }
            </div>

            <div>
              <label for="logoUpload" class="block text-sm font-medium text-gray-700 mb-2">
                Organization Logo
              </label>
              
              @if (currentLogoUrl()) {
                <div class="mb-4">
                  <p class="text-sm text-gray-600 mb-2">Current logo:</p>
                  <img [src]="currentLogoUrl()" alt="Current logo" class="h-16 w-16 object-cover rounded-lg">
                </div>
              }

              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  @if (selectedFile) {
                    <div class="flex items-center justify-center">
                      <img [src]="previewUrl" alt="Logo preview" class="h-16 w-16 object-cover rounded-lg">
                      <button
                        type="button"
                        (click)="removeFile()"
                        class="ml-2 text-red-600 hover:text-red-800"
                      >
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                      </button>
                    </div>
                  } @else {
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                      <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <div class="flex text-sm text-gray-600">
                      <label for="logoUpload" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary">
                        <span>Upload a new logo</span>
                        <input id="logoUpload" type="file" class="sr-only" accept="image/*">
                      </label>
                      <p class="pl-1">or drag and drop</p>
                    </div>
                    <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                  }
                </div>
              </div>
            </div>

            <div class="flex items-center">
              <input
                id="isActive"
                type="checkbox"
                formControlName="is_active"
                class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"
              />
              <label for="isActive" class="ml-2 block text-sm text-gray-900">
                Active organization
              </label>
            </div>

            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
              <a
                [routerLink]="['/organizations', organizationId]"
                class="bg-white py-2 px-4 border border-gray-300 rounded-xl shadow-md text-base font-semibold text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary flex items-center gap-2"
              >
                <i class="pi pi-times text-lg"></i>
                Cancelar
              </a>
              <button
                type="submit"
                [disabled]="organizationForm.invalid || saving()"
                class="bg-primary border border-transparent rounded-xl shadow-md py-2 px-4 text-base font-semibold text-white hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
              >
                @if (saving()) {
                  <div class="flex items-center">
                    <i class="pi pi-spin pi-spinner text-lg mr-2"></i>
                    Guardando...
                  </div>
                } @else {
                  <i class="pi pi-check text-lg"></i>
                  Guardar cambios
                }
              </button>
            </div>
          </form>
        </div>
      }
    </div>
  </main>
</div>
